<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portal Wi-Fi Cartório</title>
<style>
/* Reset básico */
* {box-sizing:border-box;margin:0;padding:0;}
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  background:linear-gradient(135deg,#f5f5f5,#e0e0e0);
  color:#333;
}
.container {
  background:#fff;
  padding:35px 30px;
  border-radius:20px;
  width:100%;
  max-width:400px;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,0.15);
  transition: all 0.3s ease;
}
h2 {
  margin-bottom:15px;
  font-weight:600;
  color:#222;
}
p {
  margin-bottom:20px;
  font-size:0.95rem;
  color:#555;
}
input,button {
  width:100%;
  padding:14px;
  margin:10px 0;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:1rem;
  transition:0.2s;
}
input:focus {
  border-color:#007bff;
  outline:none;
  box-shadow:0 0 8px rgba(0,123,255,0.2);
}
button {
  background:#007bff;
  color:#fff;
  font-weight:600;
  cursor:pointer;
  border:none;
}
button:hover {
  background:#0056b3;
}
.error {
  color:#d9534f;
  display:none;
  margin-bottom:10px;
  font-weight:500;
}
#timer {
  margin-top:15px;
  font-weight:600;
  font-size:1.1rem;
  color:#007bff;
  animation: fadeIn 1s ease-in-out;
}
@keyframes fadeIn {
  from {opacity:0;}
  to {opacity:1;}
}
</style>
</head>
<body>
<div class="container" id="login-container">
  <h2>Portal Wi-Fi Cartório</h2>
  <p>Por favor, preencha seus dados para acessar a rede.</p>
  <div id="error" class="error">CPF inválido!</div>
  <input type="text" id="cpf" placeholder="CPF" maxlength="14">
  <input type="text" id="nome" placeholder="Nome completo">
  <input type="email" id="email" placeholder="E-mail">
  <button onclick="entrar()">Entrar</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// Config Firebase
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_DOMINIO.firebaseapp.com",
  databaseURL: "https://SEU_DOMINIO-default-rtdb.firebaseio.com",
  projectId: "SEU_DOMINIO",
  storageBucket: "SEU_DOMINIO.appspot.com",
  messagingSenderId: "SEU_ID",
  appId: "SEU_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Tempo máximo de acesso em minutos
const TEMPO_MAX = 30;

// Formatar CPF
document.getElementById('cpf').addEventListener('input', e => {
  let v = e.target.value.replace(/\D/g,'');
  if(v.length>3) v=v.slice(0,3)+'.'+v.slice(3);
  if(v.length>7) v=v.slice(0,7)+'.'+v.slice(7);
  if(v.length>11) v=v.slice(0,11)+'-'+v.slice(11,13);
  e.target.value = v;
});

// Validar CPF
function validarCPF(cpf){
  cpf = cpf.replace(/\D/g,'');
  if(cpf.length!==11 || /^(\d)\1{10}$/.test(cpf)) return false;
  let soma=0;
  for(let i=0;i<9;i++) soma+=parseInt(cpf[i])*(10-i);
  let resto=11-(soma%11); if(resto>=10) resto=0;
  if(resto!==parseInt(cpf[9])) return false;
  soma=0;
  for(let i=0;i<10;i++) soma+=parseInt(cpf[i])*(11-i);
  resto=11-(soma%11); if(resto>=10) resto=0;
  return resto===parseInt(cpf[10]);
}

// Verifica acesso e mostra contagem regressiva
function verificarAcesso() {
  const inicio = localStorage.getItem('inicioAcesso');
  if(inicio){
    const agora = new Date().getTime();
    const inicioMs = parseInt(inicio);
    const diffMin = (agora - inicioMs) / 1000 / 60;
    if(diffMin < TEMPO_MAX){
      mostrarTimer(TEMPO_MAX*60 - (agora - inicioMs)/1000);
      return true;
    } else {
      localStorage.removeItem('inicioAcesso');
    }
  }
  return false;
}

// Mostra contagem regressiva
function mostrarTimer(segundosRestantes){
  document.body.innerHTML = `
    <div class="container">
      <h2>Bem-vindo de volta!</h2>
      <p>Você já está conectado à rede.</p>
      <div id="timer"></div>
    </div>
  `;
  const timerEl = document.getElementById('timer');
  const interval = setInterval(() => {
    if(segundosRestantes <= 0){
      clearInterval(interval);
      localStorage.removeItem('inicioAcesso');
      window.location.reload();
    } else {
      const min = Math.floor(segundosRestantes / 60);
      const seg = Math.floor(segundosRestantes % 60);
      timerEl.textContent = `Tempo restante: ${min}m ${seg}s`;
      segundosRestantes--;
    }
  }, 1000);

  // Redireciona para roteador
  setTimeout(() => {
    window.location.href = "http://192.168.1.1";
  }, 2000);
}

// Função entrar
function entrar(){
  const cpf = document.getElementById('cpf').value;
  const nome = document.getElementById('nome').value;
  const email = document.getElementById('email').value;
  const error = document.getElementById('error');

  if(!validarCPF(cpf)){
    error.style.display='block';
    return;
  }
  error.style.display='none';

  const timestamp = new Date().toISOString();
  db.ref('clientes').push({cpf,nome,email,acesso:timestamp});

  // Salva início do acesso
  localStorage.setItem('inicioAcesso', new Date().getTime());

  document.body.innerHTML = `
    <div class="container">
      <h2>Bem-vindo!</h2>
      <p>Seu CPF foi validado e registrado com sucesso.</p>
      <p>Redirecionando para a página do roteador...</p>
    </div>
  `;

  setTimeout(() => {
    window.location.href = "http://192.168.1.1";
  }, 2000);
}

// Chama verificação ao carregar
verificarAcesso();
</script>
</body>
</html>
